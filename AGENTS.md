# WQBot Agents

本文档描述 WQBot 项目中可用的 AI 代理及其用途。

## 代理概述

WQBot 支持动态代理系统，代理配置存储在 `~/.wqbot/agents/` (全局) 或 `.wqbot/agents/` (项目级)。

代理会根据用户输入自动匹配触发，也可以通过 `@代理名` 手动指定。

---

## 内置代理

### planner (规划代理)

**用途**: 复杂功能的实现规划

**触发场景**:
- 新功能开发
- 大规模重构
- 架构变更

**示例**:
```
用户: 帮我实现用户认证系统
AI: [使用 planner 代理分析需求，制定实现计划]
```

---

### architect (架构代理)

**用途**: 系统设计和架构决策

**触发场景**:
- 技术选型
- 系统设计
- 性能优化方案

**示例**:
```
用户: 我们应该用 Redis 还是 Memcached 做缓存？
AI: [使用 architect 代理分析两者优劣，给出建议]
```

---

### tdd-guide (TDD 指导代理)

**用途**: 测试驱动开发指导

**触发场景**:
- 新功能开发
- Bug 修复
- 需要高测试覆盖率

**工作流程**:
1. 编写测试 (RED)
2. 运行测试 - 应该失败
3. 编写最小实现 (GREEN)
4. 运行测试 - 应该通过
5. 重构 (IMPROVE)
6. 验证覆盖率 (80%+)

---

### code-reviewer (代码审查代理)

**用途**: 代码质量审查

**触发场景**:
- 代码编写完成后
- PR 提交前
- 重构后

**检查项**:
- 代码可读性
- 函数大小 (<50 行)
- 文件大小 (<800 行)
- 嵌套深度 (<4 层)
- 错误处理
- 安全问题

---

### security-reviewer (安全审查代理)

**用途**: 安全漏洞分析

**触发场景**:
- 提交前
- 涉及认证/授权代码
- 处理用户输入

**检查项**:
- 硬编码密钥
- SQL 注入
- XSS 漏洞
- CSRF 防护
- 输入验证

---

### build-error-resolver (构建错误解决代理)

**用途**: 修复构建错误

**触发场景**:
- 构建失败
- 类型错误
- 依赖问题

**工作流程**:
1. 分析错误信息
2. 定位问题根源
3. 增量修复
4. 验证修复

---

### e2e-runner (E2E 测试代理)

**用途**: 端到端测试

**触发场景**:
- 关键用户流程
- 发布前验证
- 回归测试

**工具**: Playwright

---

### refactor-cleaner (重构清理代理)

**用途**: 死代码清理和重构

**触发场景**:
- 代码维护
- 技术债务清理
- 性能优化

---

### doc-updater (文档更新代理)

**用途**: 文档维护

**触发场景**:
- API 变更
- 功能更新
- README 更新

---

## 自定义代理

### 创建代理

在 `~/.wqbot/agents/` 或 `.wqbot/agents/` 创建 YAML 文件：

```yaml
# my-agent.yaml
name: my-agent
description: 我的自定义代理

prompt: |
  你是一个专业的助手，专注于...

  ## 职责
  - 任务1
  - 任务2

  ## 约束
  - 约束1
  - 约束2

tools:
  - read
  - write
  - search
  - bash

triggers:
  patterns:
    - "帮我.*优化"
    - "review.*代码"
  examples:
    - "帮我优化这段代码"
    - "review 一下这个函数"
```

### 代理配置字段

| 字段 | 类型 | 说明 |
|------|------|------|
| name | string | 代理名称 |
| description | string | 代理描述 |
| prompt | string | 系统提示词 |
| tools | string[] | 可用工具列表 |
| triggers.patterns | string[] | 触发正则表达式 |
| triggers.examples | string[] | 触发示例 |

### 可用工具

- `read` - 读取文件
- `write` - 写入文件
- `edit` - 编辑文件
- `search` - 搜索代码
- `bash` - 执行命令
- `glob` - 文件匹配
- `grep` - 内容搜索

---

## 代理使用

### CLI 命令

```bash
# 进入对话模式
wqbot

# 列出所有代理
> /agent list

# 启用代理
> /agent on planner

# 禁用代理
> /agent off planner

# 创建代理（进入引导流程）
> /agent create 代码优化专家
```

### GUI 操作

在 GUI 右侧配置面板中：
- 展开 "Agents" 分组
- 点击代理名称旁的复选框切换启用/禁用
- (G) 表示全局代理，(P) 表示项目代理

### 自动触发

代理会根据用户输入自动匹配触发：

```
用户: 帮我规划一下这个功能的实现
AI: [自动使用 planner 代理]
```

### 手动指定

```
用户: @architect 分析一下这个系统的架构
AI: [使用 architect 代理]
```

---

## 多代理协作

对于复杂任务，可以并行使用多个代理：

```
用户: 帮我实现并审查用户登录功能

AI 工作流:
1. planner 代理 - 制定实现计划
2. tdd-guide 代理 - 编写测试
3. [实现代码]
4. code-reviewer 代理 - 代码审查
5. security-reviewer 代理 - 安全审查
```

---

## 代理配置热加载

代理配置支持热加载：
- 添加/修改/删除代理文件后自动生效
- 无需重启 CLI 或 GUI
- 通过 SSE 实时通知前端刷新

---

## 最佳实践

1. **选择合适的代理**: 根据任务类型选择最匹配的代理
2. **组合使用**: 复杂任务可以组合多个代理
3. **自定义代理**: 针对项目特定需求创建自定义代理
4. **定期更新**: 根据项目演进更新代理配置
5. **测试代理**: 新代理创建后进行充分测试
6. **项目级覆盖**: 项目级代理可覆盖同名全局代理

---

## 代理与技能/规则的区别

| 类型 | 用途 | 触发方式 | 配置格式 |
|------|------|----------|----------|
| **Agents** | 复杂任务处理，有独立提示词 | 自动匹配或 @指定 | YAML |
| **Skills** | 特定功能执行，如代码生成 | 斜杠命令 /skill | TypeScript |
| **Rules** | 行为约束和规范 | 始终生效 | Markdown |
